# Работа с сетевыми дисками

## Сетевые диски в сетях Microsoft

При использовании MS AD для централизованной авторизации и аутентификации практически всегда создаётся один или несколько сетевых дисков для хранения информации. 

У централизованного хранения данных есть два преимущества: 

- Во-первых, это позволяет увеличить надёжность за счёт регулярного резервного копирования. 
- Во-вторых, данные пользователя не привязаны к конкретной рабочей станции, что позволяет работать на любом компьютере организации и при необходимость быстро провести его замену при выходе их строя. Сетевые диски можно использовать даже для хранения профиля пользователя, что позволяет прозрачно для пользователя переносить настройки с одной рабочей машины на другую. Но следует держать в уме, что такие перемещаемые профили очень тяжеловесные и занимают несколько сотен мегабайт и для их быстрого копирования на рабочую станцию потребуется сеть со скоростью передачи не менее 1Гб/с для комфортной работы.

Для обмена данными с сервером при использовании сетевых дисков применяется протокол **SMB** (**CIFS**). 

Изначально протокол **SMB** работал поверх серей *IPX/SPX* с использованием *NetBIOS*. В *Windows 2000* произошёл переход на сети *TCP/IP*, но многие механизмы *NetBIOS* остались на месте. В версии 2.0, появившейся в 2006 году произошёл окончательный переход на TCP/IP и значительное упрощение протокола для увеличения скорости его работы. В 2012 году вышла версия протокола 3.0, расширяющая его возможности под современные требования, но без черезмерного усложнения, как в первой версии. Знание существующих версий необходимо, так как сейчас можно встретить системы с разной версией протокола (например, хоть протокол 1 версии имеет множество уязвимостей, до сих пор встречается ПО, которое может работать только с ним).

## Создание сетевых дисков в Windows Server 2012r2

Все необходимые компоненты для работы сетевых дисков устанавливаются в Windows Server вместе с операционной системой. 

Для создания сетевых дисков можно воспользоваться двумя путями:
- использование **контекстного меню** на имени папки
- использование **Server Manager**

В обоих случаях нужно заранее определиться, какой каталог файловой системы будет экспортирвоаться как общий по сети и как его будут видеть пользователи (какое он будет иметь внешнее имя).
При использовании контекстного меню необходимо найти папку, которую хочется превратить в сетевой диск, щёлкнуть на ней правой кнопкой мыши и выбрать пункт "**свойства**" (**properties**). В одной из вкладок будет доступен пункт "**сделать общими**" (**Share**). 

Есть два варианта настройки:
- простой (небольшое количество заранее предопределённых шаблонов прав доступа) 
- расширенный, позволяющий поменять права любым образом и выбрать любое имя сетевого ресурса. 

При названии, заканчивающемся на символ "$" сетевой ресурс не будет виден при просмотре сетевого окружения, но будет доступен при прямом обращении по имени. Для доступа к любому сетевому ресурсу его имя указывается как `\\server.fqdn\share_name`. Указанную строку можно просто ввести в адресной строке обозревателя файлов или использовать в скриптах для обращения к ней.

При использовании **Server Manager** в левой панели должен быть пункт **File and storage services**. При выборе указанного пункта появляется список всех сетевых дисков, настроенных на данном компьютере. В правом верхнем углу будет доступно меню "**Tasks**", содержащее пункт "**New Share...**", запускающий **мастер создания сетевых папок**. 

При указании прав доступа можно использовать как имена конкретных пользователей, так и группы. Использование групп более удобно для распределения прав, но на практике реализуется не всегда (обычно по историческим причинам при отсутствии в организации политик безопасности). В любом случае при настройке прав следует помнить, что при использовании MS AD на всех компьютерах домена общая база пользователей и групп. 

Оба рассматриваемых способа позволяют создать сетевой диск и выделить права доступа к нему. Для управлением правами доступа внутри сетевого диска понадобится менять права на доступ к объектам файловой системы. 

Дополнительно можно создавать:
- **квоты** - ограничение максимального суммарного объёма файлов пользователей
- **экраны** - ограничения на сохраняемые файлы

Для их использования понадобится **File Server Resourse Manager**, который доставляется как компонент (**feature**) через оснастку **Server Manager**.

## Создание сетевых дисков с использованием протокола SMB в GNU/Linux

Для создания сетевых дисков в GNU/Linux можно использовать два протокола две службы:
 - **NFS** (редко используется в системах на MS AD)
 -  **samba** 

В службу *samba* входит два компонента - сама **samba** и **winbind**, отвечающий за пространство имён пользователей и их аутентификацию. Начиная с версии 4.1 поддерживает протокол **SMB 3.0**, с версии 4.3 - последнюю версию **SMB 3.1.1**.

К  особенностям *samba* следует отнести отсутствие графических интерфейсов для создания сетевых дисков и необходимость ручной настройки конфигурационных файлов для начала работы с MS AD.
